#!/usr/bin/env node
import { execSync } from 'node:child_process';

try {
  if (!process.env.GITHUB_TOKEN) {
    console.warn('WARNING: GITHUB_TOKEN is not set. CI will provide one automatically.');
  }
  execSync('npm run tickets:sync', { stdio: 'inherit' });
  const changed = execSync('git status --porcelain', { encoding: 'utf8' }).trim();
  if (changed) {
    execSync('git add -A', { stdio: 'inherit' });
    try {
      execSync('git commit -m "chore: sync tickets â†’ GitHub issues"', { stdio: 'inherit' });
    } catch {}
  }
  process.exit(0);
} catch (e) {
  console.error('Pre-push: ticket sync failed. Ensure GITHUB_TOKEN is set or rely on CI.');
  process.exit(1);
}

