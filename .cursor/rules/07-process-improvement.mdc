---
description: "Process improvements"
globs: ["**/*"]
alwaysApply: false
---

# Lessons Learned

Append entries directly to `/docs/process-improvement.mdc`. Keep them concise: describe the trigger, the lesson, and the rule/update that resulted.

## 2025-01-XX: Playwright MCP Usage (Not Using Configured MCP)

**Trigger**: Agent ran Playwright tests via CLI (`npx playwright test`) instead of using Playwright MCP for accessibility checks and screenshots
**Lesson**: When Playwright MCP is configured, use it for accessibility checks (axe), screenshots, and Lighthouse per rules. The E2E test suite execution can still use CLI, but accessibility verification and artifact capture should leverage Playwright MCP tools.
**Root Cause**: Agent defaulted to CLI approach without checking for available MCP tools first
**Rule Update**: Always check for MCP availability before falling back to CLI. Use Playwright MCP for a11y checks, screenshots, and Lighthouse when available.

**Action Required**: 
- Check for Playwright MCP tools before running accessibility checks
- Use Playwright MCP for screenshots and accessibility verification
- Document MCP usage in test results and artifacts
- Fall back to CLI only if MCP is unavailable (document in plan)
- **Note**: Playwright MCP tools may require Cursor restart to load. If tools not visible, document fallback and note in progress.md

**Rules/Scripts Updated**:
- ✅ `.cursor/rules/04-integrations.mdc`: Playwright MCP guidance already present
- ✅ `.cursor/rules/07-process-improvement.mdc`: MCP usage lesson documented with tool list

**Tools Available** (when Playwright MCP is loaded):
- `browser_navigate` - Navigate to URLs
- `browser_snapshot` - Accessibility snapshots (preferred over screenshots for a11y)
- `browser_take_screenshot` - Screenshots for artifacts
- `browser_click`, `browser_type`, etc. - Browser interactions

## 2025-01-XX: Test Report Configuration (HTML Auto-Open)

**Trigger**: Playwright tests opened HTML report automatically, causing hangs and blocking workflow
**Lesson**: Test reports must be configured to never auto-open. Reports should be in `artifacts/` for review, with multiple formats (list for console, json for CI, html for visual review)
**Root Cause**: Playwright HTML reporter defaults to auto-opening if not explicitly disabled
**Rule Update**: Always configure Playwright with `open: 'never'` and output to `artifacts/` directory

**Action Required**: 
- Configure all test reporters with explicit output directories
- Use `artifacts/` for all test outputs (reports, screenshots, traces)
- Never auto-open HTML reports; provide paths for manual review
- Document report locations in test configuration comments

**Rules/Scripts Updated**:
- ✅ `tests/playwright.config.ts`: Already configured with `open: 'never'` and `artifacts/` output directory

## 2024-12-19: MCP-First Git Operations

**Trigger**: User requested git push, agent used terminal commands instead of GitHub MCP
**Lesson**: The rules clearly state that git operations should use GitHub MCP first (line 36 in 04-integrations.mdc: "git", "commit", "push", "branch", "pr", "pull request" → GitHub MCP)
**Root Cause**: Agent didn't check MCP triggers before falling back to terminal commands
**Rule Update**: Add explicit MCP-first check in workflow rules

**Action Required**: 
- Update workflow rules to include MCP trigger check as mandatory first step
- Add explicit "MCP-first" decision tree in git operations
- Ensure agent checks MCP availability before terminal fallback

**Rules/Scripts Updated**:
- ✅ `.cursor/rules/04-integrations.mdc`: Clarified GitHub MCP vs git CLI usage (commits use CLI, branch/PR/issue updates use MCP)

## 2025-01-XX: No Report Files - Chat Only

**Trigger**: Agent created lengthy report file (`docs/qa/ISSUE_1_FINAL_QA_REPORT.md`) when user requested QA/QC
**Lesson**: **NEVER create report files**. Reports should be in chat only. Update GitHub issues/docs directly, keep reports concise and conversational.
**Root Cause**: Agent defaulted to creating documentation files instead of providing chat-based summary
**Rule Update**: QA/QC reports must be in chat only. Update GitHub issues and docs (changelog, progress.md) directly, but never create standalone report files.

**Action Required**: 
- Reports in chat only - no `.md` report files
- Update GitHub issues with completion status
- Update changelog/docs if needed
- Keep reports concise (Status, Next 3, Question format)
- Delete any report files created

**Rules/Scripts Updated**:
- ✅ `.cursor/rules/persona-pixel.mdc`: Added guardrail "NEVER create report files"
- ✅ `.cursor/rules/persona-muse.mdc`: Added guardrail "NEVER create report files"

## 2025-11-06: Issue Completion Workflow (Git Commit & Push + Branch Naming)

**Trigger**: Agent completed Issue #1 verification but didn't: 1) Use proper branch naming, 2) Update GitHub issue, 3) Commit/push changes
**Lesson**: When completing a feature/issue, always: 1) Create branch with proper format FIRST (`agent/<agent>/<issue>-<slug>` per `.cursor/rules/01-workflow.mdc`), 2) Update GitHub issue with completion comment, 3) Commit changes with descriptive message referencing issue, 4) Ask before pushing (per rules)
**Root Cause**: Agent worked on existing branch (`feat/playwright-health-status`) instead of creating proper branch for Issue #1, then didn't complete workflow closure
**Rule Update**: Feature completion checklist must include: Create proper branch FIRST, GitHub issue update, git commit, push (ask before push per rules)

**Action Required**:
- **Before starting work**: Create branch with format `agent/<agent>/<issue>-<slug>` (e.g., `agent/vector/1-onboarding-flow`)
- After verification/implementation complete: Update GitHub issue with completion comment
- Commit all changes with message referencing issue number: `feat: Complete Issue #X - [description]`
- Ask before pushing (per agent rules)
- Include test results and verification summary in commit message

**Rules/Scripts Updated** (not just documented):
- ✅ `AGENTS.md` rule #9: Enforce branch creation BEFORE work starts
- ✅ `AGENTS.md` rule #13: Enforce issue completion checklist (GitHub issue update, commit, push)
- ✅ `.cursor/rules/01-workflow.mdc` Section 2: MANDATORY branch creation before work
- ✅ `.cursor/rules/01-workflow.mdc` Section 6: Issue completion checklist
- ✅ `.cursor/rules/02-quality.mdc`: Git hygiene updated with branch naming requirement
- ✅ `tools/preflight.mjs`: Added `checkBranchNaming()` function (validates branch format)
- ✅ `scripts/hooks/pre-commit.sample`: Added branch naming warning (non-blocking)
- ✅ `.cursor/rules/04-integrations.mdc`: Clarified GitHub MCP vs git CLI usage

## 2025-01-XX: Windows Git Push Subprocess Limitation

**Trigger**: Git push fails in Cursor subprocess context on Windows with `getaddrinfo() thread failed to start` error  
**Lesson**: Windows git threading issue affects subprocess contexts. Git push may require manual execution from user's terminal (outside Cursor's subprocess).  
**Root Cause**: Windows DNS threading bug in git's HTTP client when executed in subprocess context  
**Rule Update**: If git push fails in Cursor with Windows threading error, document commits are ready and provide manual push command for user's terminal

**Action Required**:
- When git push fails with threading error, verify commits are ready: `git log --oneline -3`
- Provide user with manual push command: `git push origin <branch-name>`
- Document in issue completion: "Commits ready locally, pushed manually due to Windows threading limitation"
- Update workflow to note Windows subprocess limitation

**Rules/Scripts Updated**:
- ✅ `docs/research.md`: Documented Windows git push issue with solutions and trade-offs
- ✅ `.cursor/rules/07-process-improvement.mdc`: Added lesson for Windows subprocess limitation
