---
description: "Process improvements"
globs: ["**/*"]
alwaysApply: false
---

# Lessons Learned

**Format**: Keep entries to 2-3 sentences max. Include: trigger, lesson, rule update. No verbose sections. **Date format**: Always use the current system date in YYYY-MM-DD format when creating new entries. Never use placeholder dates like "2025-01-XX" or future dates. Check system date before adding entries.

## 2025-11-10: Missing Dependency Import Crash

**Trigger**: Backend crashed on startup because `@sentry/node` was imported but not installed. **Lesson**: Never use static imports for optional dependencies - use dynamic `import()` with try-catch. **Rule**: Added dependency check to preflight, use dynamic imports for optional packages.

## 2025-11-10: Research Before Fixing

**Trigger**: Agent fixed tests without researching root cause first. **Lesson**: Mandatory research protocol: gather evidence (errors, logs, network) → understand root cause → research solutions → then fix. **Rule**: Added to `.cursor/rules/02-quality.mdc` - never jump to fixes without investigation.

## 2025-11-10: Testing Infrastructure Gaps

**Trigger**: Tests hanging without timeouts, missing security/edge case coverage. **Lesson**: All tests need timeouts, centralized logging, security/edge case tests, performance automation. **Rule**: Created `.cursor/rules/08-testing.mdc` with tool selection and timeout requirements.

## 2025-11-09: Supabase MCP Migration

**Trigger**: Supabase MCP npm package required undocumented `MCP_API_KEY`. **Lesson**: Use official hosted server (`https://mcp.supabase.com/mcp`) - simpler, more secure, browser auth. **Rule**: Updated `.cursor/mcp.json` to use URL-based config, removed env var requirement.

## 2025-11-10: Issue Completion Protocol

**Trigger**: User had to remind agent to push commits and update GitHub issue. **Lesson**: Completion steps (push, GitHub comment, labels) are mandatory and automatic - no user reminders needed. **Rule**: Updated `.cursor/rules/01-workflow.mdc` Section 6 - automatic completion steps.

## 2025-11-10: Playwright MCP Usage

**Trigger**: Agent used CLI instead of Playwright MCP for accessibility checks. **Lesson**: When MCP is configured, use it for a11y checks, screenshots, Lighthouse - check MCP availability before CLI fallback. **Rule**: Documented in `.cursor/rules/04-integrations.mdc`.

## 2025-11-10: Test Report Auto-Open

**Trigger**: Playwright HTML reports auto-opened, causing hangs. **Lesson**: Configure all reporters with `open: 'never'` and output to `artifacts/`. **Rule**: Updated `tests/playwright.config.ts` with explicit no-auto-open config.

## 2024-12-19: MCP-First Git Operations

**Trigger**: Agent used terminal instead of GitHub MCP for git operations. **Lesson**: Check MCP triggers first - GitHub MCP for branch/PR/issue updates, git CLI for commits. **Rule**: Clarified in `.cursor/rules/04-integrations.mdc`.

## 2025-11-10: No Report Files

**Trigger**: Agent created lengthy report file when user requested QA. **Lesson**: Never create report files - reports in chat only, update GitHub issues/docs directly. **Rule**: Added guardrails to Pixel and Muse personas.

## 2025-11-06: Issue Completion Workflow

**Trigger**: Agent didn't create proper branch or update GitHub issue. **Lesson**: Create branch FIRST (`agent/<agent>/<issue>-<slug>`), then update GitHub issue, commit, push. **Rule**: Enforced in `AGENTS.md` and `.cursor/rules/01-workflow.mdc`.

## 2025-11-06: Windows Git Push Issues

**Trigger**: Git push failed with DNS threading error, then 403 after restart. **Lesson**: Create branch on GitHub FIRST via MCP, use system Git if Cursor's bundled Git fails, check token scopes for 403 errors. **Rule**: Updated troubleshooting docs with PC restart and auth scope solutions.

## 2025-11-06: Direct Commits Only

**Trigger**: User prefers direct commits, no PRs. **Lesson**: Always direct commits to feature branches - no PRs ever. **Rule**: Updated `.cursor/rules/01-workflow.mdc` Section 5.

## 2025-11-10: Test Skipping Anti-Pattern

**Trigger**: Tests were skipped instead of fixed when supertest timed out. **Lesson**: Never skip tests - fix root causes or switch to working patterns (use `fetch()` + test server instead of supertest). **Rule**: Updated `.cursor/rules/08-testing.mdc` - never skip, use proven patterns.

## 2025-11-10: Cursor Bundled Git Issues

**Trigger**: Cursor's Git push failed with DNS threading error, system Git worked fine. **Lesson**: When Cursor's bundled Git fails, use system Git from terminal - it works reliably on Windows. **Rule**: Added to troubleshooting docs - use system Git as fallback.

## 2025-11-10: Git Safety Checks

**Trigger**: Git operations attempted from wrong directory, wrong branch detected. **Lesson**: Mandatory checks before ANY git operation: verify project root directory, verify branch matches issue number. **Rule**: Added to `.cursor/rules/01-workflow.mdc` - never run git from parent directories.

## 2025-11-10: Issue Completion Status Tracking

**Trigger**: Issue marked complete in commit but progress.md/current.json showed incomplete. **Lesson**: Status files are source of truth - update progress.md and current.json BEFORE committing completion. **Rule**: Added mandatory status file updates to completion checklist in `.cursor/rules/01-workflow.mdc`.

## 2025-11-10: Smart Process Cleanup

**Trigger**: Process cleanup needed to preserve MCP/Cursor processes while killing project dev servers. **Lesson**: Identify processes by command-line patterns (project path, dev commands) while excluding MCP and Cursor processes. **Rule**: Created smart cleanup script with pattern matching, updated cleanup guidance.
