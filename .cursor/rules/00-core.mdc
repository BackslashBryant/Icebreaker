---
description: "Core development principles"
globs: ["**/*"]
alwaysApply: true
---

# Cursor Vibe Operating Agreement

## Flow > Friction
- Start each session by checking intention: prototype, polish, or ship. Narrate it so the agent matches your energy.
- Begin with `docs/vision.md`, `docs/ConnectionGuide.md`, and `.notes/features/current.json` so everyone shares context.
- Prefer Plan Mode (Shift+Tab) for anything beyond a single edit. Let the agent draft the plan, tweak it, then build.
- Keep prompts conversational; voice input, queued messages (Ctrl+Enter), and saved plans are all welcome.

## Safety Rails We Keep Even When Vibing
- **MANDATORY WORKFLOW CHECKPOINTS**: Before starting ANY implementation work, verify:
  1. Research file exists: `docs/research/Issue-<#>-research.md`
  2. Plan file exists: `docs/Plan.md` with checkpoints
  3. **Team review approval file exists**: `.notes/features/<slug>/team-review-approved.md`
- **IF ANY CHECK FAILS**: STOP immediately. Do not create, modify, or commit any implementation files. Coordinate with Vector for team review.
- **MANDATORY GIT SAFETY CHECKS**: Before ANY git operation (add, commit, push), verify:
  1. Current directory is project root: Run `git rev-parse --show-toplevel` and ensure you're in that exact directory
  2. Current branch matches issue: Run `git branch --show-current` and confirm branch name contains the issue number being worked on
  3. No parent directory scanning: `git status` should NOT show files outside the repository (no warnings about AppData, Documents, etc.)
  4. If directory is wrong: Navigate to project root with `cd "$(git rev-parse --show-toplevel)"` (PowerShell: `cd (git rev-parse --show-toplevel)`)
  5. If branch is wrong: Create correct branch or switch before committing
- **NEVER** run git commands from parent directories or outside the repository
- Never ship code you have not read; sanity-check diffs and run the quickest meaningful verification.
- Flag real secrets, prod data, or compliance-sensitive areas before asking the agent to touch them.
- Document gotchas in `.notes/` or the active plan so the next session inherits your context.
- Be stupidly specific: name files, selectors, colors, padding, payload keys. Vague in -> vague out.
- Ask before committing, pushing, installing new tech, or touching new services. Present the proposed command first.
- No mock data in production paths. If placeholders are required, confirm with the caller or Pixel.
- Maintain `docs/ConnectionGuide.md` anytime a port, endpoint, or credential changes.
- When loops happen, stop, capture them in the **Current Issues** section of `.notes/features/<slug>/progress.md`, and restart the chat with that context.

## Collaboration Rituals
- Reference `docs/agents/PLAYBOOK.md` for handoffs, tone, and checkpoints.
- Pin the quick guides under `docs/cursor/` (extensions, symbols, agent tooling) so Cursor stays the SME for new teammates.
- Mention focused rules (e.g. `@rules/testing`) or docs on demand instead of loading the entire library.
- Celebrate experiments: capture wins/misses in `.notes/` (session log) and roll durable lessons into `/docs/process-improvement.mdc` so artifacts capture the session.
- **Cursor vs App Logic Separation**: This repository distinguishes between template mode (Cursor files tracked) and app mode (Cursor files blocked). See `docs/development/SEPARATION.md` for details. In app mode, `.cursor/` modifications are blocked from commits unless `ALLOW_CURSOR_PUSH=1` is set (template updates only). Run `npm run convert:app` when shifting from template to app development.

## Exit Checklist
- Plans, vision, connection guide, and TODOs updated, even if you bail mid-flight.
- Verification helper (`scripts/verify-all` via your preferred runner) invoked after the final change and results shared.
- Queue final instructions or checkpoint status so the next agent can continue without guessing.

## No Kicking Cans Down the Road

**CRITICAL RULE**: Never defer fixing test infrastructure issues, bugs, or technical debt. If you identify a problem, fix it immediately. Do not skip tests, add TODOs, or document issues for "later" unless explicitly requested by the user.

**When you find a test infrastructure issue:**
1. **Fix it immediately** - Don't skip tests or add workarounds
2. **Root cause analysis** - Understand why it's failing, not just the symptom
3. **Proper solution** - Use the right approach (e.g., React Router navigation vs `page.goto()` for SPA tests)
4. **Verify the fix** - Ensure tests pass consistently
5. **Document the pattern** - Update rules/processes if this is a recurring issue

**Examples of what NOT to do:**
- ❌ `test.skip()` with a comment "TODO: fix session persistence"
- ❌ Adding `waitForTimeout` as a workaround
- ❌ Documenting issues in a "known issues" file without fixing
- ❌ Using workarounds that mask the real problem

**Examples of what TO do:**
- ✅ Fix the root cause (e.g., use React Router navigation instead of `page.goto()`)
- ✅ Update test helpers to prevent the issue from recurring
- ✅ Update rules/processes to codify the solution
- ✅ Verify the fix works consistently

**Exception**: Only defer if the user explicitly requests it or if fixing it would require architectural changes that are out of scope for the current task.
- Be precise about what succeeded, what failed, and where confidence is low; do not exaggerate accomplishments or gloss over blockers.
- Cite evidence (test output, screenshots, logs) when claiming results.
- When something breaks, document it honestly, propose next steps, and update `.cursor/rules/07-process-improvement.mdc` or other rules so the lesson persists.
- Curate Cursor memories deliberately: propose only reusable insights (architecture, naming), never secrets/PII, and decline noisy suggestions.
