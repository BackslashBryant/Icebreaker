---
description: "MCP Integrations – GitHub, Supabase, Playwright, Desktop Commander, Ref Tools, Toolbox"
globs: ["**/*"]
alwaysApply: true
---

# MCP Integrations

These MCP servers are accelerators—not autopilot. Use them when they reduce risk, cite outputs when they influence a decision, and fall back to the CLI only when the MCP path is blocked.

## Principles
- Stay in ticket scope. Propose the exact command/query before running it and wait for approval.
- Prefer scripted helpers (see `tools/` and `examples/automation/`) so operations are reproducible.
- Log meaningful results (links, summaries, screenshots) in `/docs/research.md`, `artifacts/`, or the relevant doc.
- If an MCP fails twice, document it in `.notes/features/<slug>/progress.md` and suggest the fallback.

## When to Reach for Which Tool
- **GitHub MCP** – Branch/PR automation, repo search, code examples, issue comments. First stop for anything "git" or GitHub API shaped (except commits - use git CLI for commits).
- **Note**: Git commits use CLI (GitHub MCP doesn't have commit tool), but branch creation, PRs, and issue updates should use GitHub MCP.
- **Ref Tools MCP** – Token-efficient documentation search for APIs, libraries, services. Supports private repos and PDFs. Cite sources in `/docs/research.md`.
- **Playwright MCP** – UI screenshots, axe/Lighthouse accessibility/perf checks. Attach outputs to the ticket or artifacts.
- **Supabase MCP Lite** – Database schema diffs, SQL experiments, policy checks (if Supabase is chosen). Update `docs/ConnectionGuide.md` when endpoints change.
- **Desktop Commander MCP** – Local shell/file automation aligned with the allowlist in `.cursor/tools/policy.md`.
- **Toolbox MCP** – Search for and discover additional MCP servers in the Smithery registry.

## Plan vs Act Expectations
1. **Plan Mode** – State which MCP you intend to use, the command/query, expected outcome, and rollback. Await approval.
2. **Act Mode** – Execute exactly what was approved. Share the raw output (trimmed) plus a one-line interpretation.
3. **Log** – Place citations or artifacts where the next agent will find them (`/docs/research.md`, `artifacts/<issue>/…`, README updates via Muse, etc.).

## Health Checks
- Run `npm run preflight` at the start of a session to confirm baseline MCP servers respond.
- `npm run mcp:suggest` highlights additional servers worth enabling; document decisions in `.notes/features/<slug>/progress.md`.
- Nexus records any credential or config changes in `docs/ConnectionGuide.md` before closing a task.

## Fallback Protocol
1. Pause and report the outage (include the MCP name and error).
2. Suggest an approved fallback (CLI, SDK, manual step) if it stays within scope.
3. Capture the variance in the plan or Current Issues log so future runs know why the MCP was skipped.

Treat MCP usage with the same care as code changes—propose, approve, execute, and document.
